<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title> ØªÙ…Ø±ÙŠÙ† ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ù…Ù„</title>
    <link href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Temel Sayfa Stilleri --- */
        :root {
            --accent-color: #007bff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --bg-light: #f8f9fa;
            --font-arabic: 'Markazi Text', 'Noto Naskh Arabic', 'Tahoma', 'Arial', sans-serif;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        body {
            font-family: var(--font-arabic);
            background-color: #e9ecef;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            font-weight: 400;
            touch-action: none;
            transition: background-color 0.3s;
        }

        body.fullscreen {
            background-color: #000;
        }

        /* --- BAÅLANGIÃ‡ EKRANI --- */
        #start-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        #start-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 20px 60px;
            font-size: 3rem;
            font-family: var(--font-arabic);
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(40, 167, 69, 0.6);
            animation: pulse-btn 1.5s infinite;
        }
        @keyframes pulse-btn {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(40, 167, 69, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }

        /* --- CÄ°HAZ DÃ–NDÃœRME UYARISI (Dikey Mod Kilidi) --- */
        #rotate-message {
            display: none; 
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: #2c3e50; 
            z-index: 9999; 
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }
        .phone-animation {
            width: 60px; height: 100px;
            border: 4px solid white;
            border-radius: 10px;
            animation: rotate-phone 2s infinite ease-in-out;
            margin-bottom: 20px;
            position: relative;
        }
        .phone-animation::before {
            content: '';
            position: absolute;
            top: 10px; left: 50%;
            transform: translateX(-50%);
            width: 20%; height: 4px;
            background: white;
            border-radius: 2px;
        }
        @keyframes rotate-phone {
            0% { transform: rotate(0deg); opacity: 1; }
            25% { transform: rotate(90deg); opacity: 1; }
            70% { transform: rotate(90deg); opacity: 1; }
            100% { transform: rotate(90deg); opacity: 0; }
        }
        .rotate-text { font-size: 2rem; font-family: var(--font-arabic); }

        @media only screen and (max-width: 900px) and (orientation: portrait) {
            #rotate-message { display: flex; }
            .activity-container { display: none !important; } 
            #start-overlay { display: none !important; }
        }

        /* --- ANA KONTEYNER --- */
        .activity-container {
            position: relative;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            
            /* VarsayÄ±lan 16:9 MasaÃ¼stÃ¼ OranÄ± */
            width: 90vw;
            height: calc(90vw * 9 / 16);
            max-height: 90vh;
            max-width: calc(90vh * 16 / 9);
            
            transition: all 0.3s ease; 
        }

        /* --- TAM EKRAN MODU (Hem Mobil Hem MasaÃ¼stÃ¼ Ä°Ã§in GeÃ§erli) --- */
        body.fullscreen .activity-container, .activity-container.mobile-fullscreen {
            width: 100vw !important;
            height: 100vh !important;
            height: 100dvh !important; /* Mobilde adres Ã§ubuÄŸunu hesaba kat */
            max-width: none !important;
            max-height: none !important;
            border-radius: 0 !important;
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        /* --- HEADER (MasaÃ¼stÃ¼ DÃ¼zeni Korundu) --- */
        .header {
            padding: 10px 20px;
            border-bottom: 1px solid #dee2e6;
            display: grid;
            /* Soldan SaÄŸa: Ä°lerleme | BaÅŸlÄ±k | Butonlar */
            /* RTL olduÄŸu iÃ§in gÃ¶rsel olarak: SaÄŸda Ä°lerleme, Ortada BaÅŸlÄ±k, Solda Butonlar */
            grid-template-areas: "progress instruction back"; 
            grid-template-columns: 200px 1fr 200px;
            align-items: center;
            gap: 20px;
            flex-shrink: 0;
            background: white;
            height: 120px; /* Sabit yÃ¼kseklik */
        }
        
        /* Mobilde Header SÄ±kÄ±ÅŸÄ±rsa DÃ¼zenleme */
        @media (max-width: 800px) {
            .header {
                grid-template-columns: 120px 1fr 120px; /* Daha dar kolonlar */
                padding: 5px 10px;
                height: 60px;
            }
        }

        /* Progress Bar */
        .progress-container { 
            grid-area: progress;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: flex-start;
            width: 100%;
            direction: ltr; /* Ä°lerleme soldan saÄŸa */
        }
        #progress-display {
            font-size: 1.2rem; 
            font-weight: bold;
            color: var(--accent-color);
            flex-shrink: 0;
        }
        .progress-bar-container {
            flex-grow: 1;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--accent-color);
            transition: width 0.4s ease;
        }

        /* Instruction Text */
        #instruction-text { 
            grid-area: instruction;
            text-align: center; 
            font-size: 3.0rem; 
            font-weight: 700;
            color: #555;
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Back Buttons */
        .back-button-container {
            grid-area: back;
            display: flex;
            justify-content: flex-end; 
            align-items: center; 
            gap: 10px;
        }
        .back-button, #fullscreen-btn {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            width: 40px; height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0; 
            text-decoration: none;
        }
        .back-button:hover, #fullscreen-btn:hover { background: #e0e0e0; }
        .back-button svg, #fullscreen-btn svg { width: 22px; height: 22px; fill: currentColor; }
        
        #fullscreen-btn .icon-open { display: block; }
        #fullscreen-btn .icon-close { display: none; }
        body.fullscreen #fullscreen-btn .icon-open { display: none; }
        body.fullscreen #fullscreen-btn .icon-close { display: block; }

        /* --- ETKÄ°NLÄ°K ALANI --- */
        .activity-area {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-y: auto;
            position: relative;
        }

        .scramble-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            justify-content: space-between; /* Dikeyde yay */
        }
        
        .drop-zone, .drag-zone {
    border: 3px dashed #d0d0d0; /* Ã‡erÃ§eveyi biraz kalÄ±nlaÅŸtÄ±rdÄ±k */
    border-radius: 15px;
    padding:30px;       /* Ä°Ã§ boÅŸluÄŸu artÄ±rdÄ±k */
    margin: 15px 0;
    min-height: 180px;   /* Kutunun yÃ¼ksekliÄŸini artÄ±rdÄ±k (bÃ¼yÃ¼k kartlar sÄ±ÄŸsÄ±n diye) */
    background: var(--bg-light);
    display: flex;
    flex-wrap: wrap;
    align-content: center; 
    flex-grow: 1; 
    transition: background-color 0.3s, border-color 0.3s; 
    gap: 15px;           /* Kartlar arasÄ± boÅŸluÄŸu artÄ±rdÄ±k */
    justify-content: center;
}
        .drop-zone {
            border-style: solid;
            border-color: var(--accent-color);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-8px); }
            40%, 80% { transform: translateX(8px); }
        }
        .drop-zone-correct {
            border-color: var(--success-color);
            background-color: #f0f9f2; 
        }
        .drop-zone-incorrect {
            border-color: var(--danger-color);
            background-color: #fcf2f2; 
            animation: shake 0.4s ease-in-out;
        }
        
        /* KELÄ°ME KARTLARI (Ã–lÃ§eklenebilir Font - vmin kullanarak) */
        .word-item {
            padding: 15px 30px;
            color: white;
            font-size: 3.5rem; /* MasaÃ¼stÃ¼ iÃ§in varsayÄ±lan */
            font-weight: 700;
            margin: 10px;
            border-radius: 12px;
            cursor: grab; 
            user-select: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            line-height: 1.4; 
            display: inline-block;
        }
        .word-item[draggable="true"]:active { cursor: grabbing; }
        .word-item:hover { filter: brightness(85%); }
        .word-item.dragging { opacity: 0.5; cursor: grabbing; }

        /* Mobilde Font Boyutunu Dinamik Yap */
        @media (max-width: 900px) {
             .word-item {
                 font-size: clamp(1.2rem, 6vmin, 2rem); /* Ekran kÃ¼Ã§Ã¼ldÃ¼kÃ§e yazÄ± da kÃ¼Ã§Ã¼lÃ¼r */
                 padding: 6px 12px;
             }
        }
        
        /* KONTROLLER (Controls) */
        .scramble-controls {
            position: relative; 
            display: flex; justify-content: center; align-items: center; 
            margin-top: 10px; flex-shrink: 0; min-height: 60px; width: 100%; 
        }

        #check-scramble-btn, #reset-scramble-btn {
            /* padding'i azalttÄ±k Ã§Ã¼nkÃ¼ geniÅŸliÄŸi sabitleyeceÄŸiz */
            padding: 15px 0; 
            
            /* Ä°ki butonu da aynÄ± geniÅŸliÄŸe sabitliyoruz */
            width: 200px; 
            height: 100px;   
            
            font-size: 2.5rem;
            font-family: var(--font-arabic);
            font-weight: 800;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 15px;
            color: white;
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            
            /* YazÄ± ve ikonun tam ortada durmasÄ± iÃ§in */
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }

        /* Hover efekti aynÄ± kalabilir */
        #check-scramble-btn:hover, #reset-scramble-btn:hover {
            transform: scale(1.05);
        }
        #check-scramble-btn { background-color: var(--success-color); }
        #reset-scramble-btn { background-color: var(--danger-color); }
        
        .disabled-btn { opacity: 0.4; cursor: not-allowed !important; pointer-events: none; filter: grayscale(100%); }

        #next-activity-btn {
            background-color: var(--accent-color); color: white;
            padding: 0; border: none;
            width: 60px; height: 60px; border-radius: 50%; 
            display: none; align-items: center; justify-content: center;
            margin: 5px; cursor: pointer;
        }
        #next-activity-btn svg { width: 30px; height: 30px; fill: currentColor; }

        #hint-btn {
            background-color: #ffc107; color: #333;
            border: none; border-radius: 50%;
            width: 60px; height: 60px;
            font-size: 2rem; cursor: pointer;
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            display: flex; visibility: hidden; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(255, 193, 7, 0.4);
            animation: pulse 1.5s infinite; z-index: 10; 
        }
        @keyframes pulse {
            0% { transform: translateY(-50%) scale(1); }
            70% { transform: translateY(-50%) scale(1.1); }
            100% { transform: translateY(-50%) scale(1); }
        }
        
        #finish-screen {
            text-align: center; font-weight: 700; color: var(--accent-color);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; font-family: var(--font-arabic);
        }
        #finish-screen p { font-size: 3rem; margin: 10px 0; }
        .score-display { display: flex; gap: 30px; font-size: 2.5rem; margin: 20px 0; direction: ltr; }
        .score-item { font-weight: 700; }
        .score-correct { color: var(--success-color); }
        .score-incorrect { color: var(--danger-color); }
        #replay-button {
            font-size: 4rem; background: none; border: none; cursor: pointer;
            padding: 10px; border-radius: 50%;
            transition: transform 0.2s ease, background-color 0.2s ease;
            font-family: var(--font-arabic);
        }
        #replay-button:hover { transform: rotate(-90deg); background-color: #f0f0f0; }

        /* ============================================================
           MOBÄ°L YATAY (LANDSCAPE) - SADECE Ã–LÃ‡EKLENDÄ°RME
           MasaÃ¼stÃ¼ dÃ¼zenini bozmadan sÄ±ÄŸdÄ±rma kurallarÄ±
           ============================================================ */
        @media only screen and (max-height: 600px) and (orientation: landscape) {
            /* Konteyner ekrana sÄ±ÄŸacak ÅŸekilde tam boyut */
            .activity-container {
                width: 100vw;
                height: 100dvh; /* Adres Ã§ubuÄŸunu hesaba kat */
                border-radius: 0;
                max-width: none;
                max-height: none;
            }
            
            /* YazÄ±larÄ± biraz kÃ¼Ã§Ã¼lt ama yapÄ± aynÄ± kalsÄ±n */
            .header {
                height: 50px;
                padding: 5px 15px;
                gap: 10px;
            }
            #instruction-text { font-size: 1.4rem; }
            
            .drop-zone, .drag-zone {
                min-height: 60px;
                padding: 5px;
                margin: 5px 0;
            }
            
            /* Butonlar biraz kÃ¼Ã§Ã¼lsÃ¼n */
            #check-scramble-btn, #reset-scramble-btn {
                font-size: 1.1rem;
                padding: 8px 20px;
            }
            
            /* Ä°pucu ve Ä°leri butonu */
            #hint-btn, #next-activity-btn {
                width: 45px; height: 45px;
                font-size: 1.5rem;
            }
        }

    </style>
</head>
<body>

    <div id="rotate-message">
        <div class="phone-animation"></div>
        <div class="rotate-text">ÙŠÙØ±Ø¬Ù‰ ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¬Ù‡Ø§Ø²</div> 
    </div>

    <div id="start-overlay">
        
        <button id="start-btn">Ø§ÙØ¨Ù’Ø¯ÙØ£Ù’</button>
    </div>

    <div class="activity-container">
        
        <div class="header">
            <div class="progress-container">
                <div id="progress-display">...</div> 
                <div class="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
            </div>
            
            <div id="instruction-text">...</div>

            <div class="back-button-container">
                <button id="fullscreen-btn">
                    <svg class="icon-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 10h2V7h3V5H5v5zM14 5v2h3v3h2V5h-5zM5 19v-5h2v3h3v2H5zM14 19v-2h3v-3h2v5h-5z"/>
                    </svg>
                    <svg class="icon-close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
                    </svg>
                </button>
                
                <a href="index.html" class="back-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </a>
            </div>
        </div>

        <div class="activity-area" id="activity-area">
            </div>

    </div>

    <script>
        const startOverlay = document.getElementById('start-overlay');
        const startBtn = document.getElementById('start-btn');

        startBtn.addEventListener('click', () => {
            startOverlay.style.display = 'none';
            initAudioContext();
            const docEl = document.documentElement;
            if (docEl.requestFullscreen) {
                docEl.requestFullscreen().catch(err => console.log(err));
            } else if (docEl.webkitRequestFullscreen) { 
                docEl.webkitRequestFullscreen();
            } else if (docEl.msRequestFullscreen) { 
                docEl.msRequestFullscreen();
            }
        });

        // --- ETKÄ°NLÄ°K VERÄ°LERÄ° ---
         const activitiesData = [
    {
        s: ["Ø£ÙØ¹ÙŠØ´Ù ÙÙŠ Ù…ÙØ¯ÙŠÙ†ÙØ© Ù‚ÙˆÙ†Ù’ÙŠØ§", "ÙÙŠ Ù…ÙØ¯ÙŠÙ†ÙØ© Ù‚ÙˆÙ†Ù’ÙŠØ§ Ø£ÙØ¹ÙŠØ´Ù"],
        w: ["Ø£ÙØ¹ÙŠØ´Ù", "ÙÙŠ", "Ù…ÙØ¯ÙŠÙ†ÙØ©", "Ù‚ÙˆÙ†Ù’ÙŠØ§"]
    },
    {
        s: ["ØªÙØ´Ù’ØªÙÙ‡ÙØ±Ù Ù‚ÙˆÙ†Ù’ÙŠØ§ Ø¨ÙÙ€Ù…ÙØªÙ’Ø­ÙÙ Ù…ÙÙˆÙ’Ù„Ø§Ù†Ø§"],
        w: ["ØªÙØ´Ù’ØªÙÙ‡ÙØ±Ù", "Ù‚ÙˆÙ†Ù’ÙŠØ§", "Ø¨ÙÙ€Ù…ÙØªÙ’Ø­ÙÙ", "Ù…ÙÙˆÙ’Ù„Ø§Ù†Ø§"]
    },
    {
        s: ["ØªÙÙ‚ÙØ¹Ù Ø£ÙÙ†Ù’Ù‚ÙØ±ÙØ© ÙÙŠ ÙˆÙØ³ÙØ· ØªÙØ±Ù’ÙƒÙÙŠØ§", "Ø£ÙÙ†Ù’Ù‚ÙØ±ÙØ© ØªÙÙ‚ÙØ¹Ù ÙÙŠ ÙˆÙØ³ÙØ· ØªÙØ±Ù’ÙƒÙÙŠØ§"],
        w: ["ØªÙÙ‚ÙØ¹Ù", "Ø£ÙÙ†Ù’Ù‚ÙØ±ÙØ©", "ÙÙŠ", "ÙˆÙØ³ÙØ·", "ØªÙØ±Ù’ÙƒÙÙŠØ§"]
    },
    {
        s: ["ØªÙØ¬ÙÙˆÙÙ‘Ù„Ù’ØªÙ ÙÙŠ Ø¨ÙØ­ÙÙŠÙ’Ø±ÙØ© Ø§Ù„Ø£ÙØ³Ù’Ù…Ø§Ùƒ ÙÙŠ Ø£ÙˆØ±Ù’ÙÙØ©"],
        w: ["ØªÙØ¬ÙÙˆÙÙ‘Ù„Ù’ØªÙ", "ÙÙŠ", "Ø¨ÙØ­ÙÙŠÙ’Ø±ÙØ©", "Ø§Ù„Ø£ÙØ³Ù’Ù…Ø§Ùƒ", "ÙÙŠ", "Ø£ÙˆØ±Ù’ÙÙØ©"]
    },
    {
        s: ["Ø²ÙØ±Ù’ØªÙ Ù…ÙØ³Ù’Ø¬ÙØ¯ Ø¢ÙŠØ§ØµÙˆÙÙ’ÙŠØ§ Ø§Ù„ÙƒÙØ¨ÙŠØ± ÙÙŠ Ø¥ÙØ³Ù’Ø·ÙÙ†Ù’Ø¨ÙˆÙ„"],
        w: ["Ø²ÙØ±Ù’ØªÙ", "Ù…ÙØ³Ù’Ø¬ÙØ¯", "Ø¢ÙŠØ§ØµÙˆÙÙ’ÙŠØ§", "Ø§Ù„ÙƒÙØ¨ÙŠØ±", "ÙÙŠ", "Ø¥ÙØ³Ù’Ø·ÙÙ†Ù’Ø¨ÙˆÙ„"]
    },
    {
        s: ["ØªÙÙ‚ÙØ¹Ù Ø·ÙØ±Ø§Ø¨Ù’Ø²ÙˆÙ† ÙÙŠ Ø´ÙÙ…Ø§Ù„ ØªÙØ±Ù’ÙƒÙÙŠØ§"],
        w: ["ØªÙÙ‚ÙØ¹Ù", "Ø·ÙØ±Ø§Ø¨Ù’Ø²ÙˆÙ†", "ÙÙŠ", "Ø´ÙÙ…Ø§Ù„", "ØªÙØ±Ù’ÙƒÙÙŠØ§"]
    },
    {
        s: ["ØªÙÙ‚ÙØ¹Ù Ù…ÙØ±Ù’Ø³ÙŠÙ† ÙÙŠ Ø¬ÙÙ†ÙˆØ¨ ØªÙØ±Ù’ÙƒÙÙŠØ§"],
        w: ["ØªÙÙ‚ÙØ¹Ù", "Ù…ÙØ±Ù’Ø³ÙŠÙ†", "ÙÙŠ", "Ø¬ÙÙ†ÙˆØ¨", "ØªÙØ±Ù’ÙƒÙÙŠØ§"]
    },
    {
        s: ["Ù„ÙØ§ Ø´ÙÙŠÙ’Ø¡ Ø£ÙØºÙ’Ù„Ù‰ Ù…ÙÙ†Ù Ø§Ù„Ù’ÙˆÙØ·ÙÙ†"],
        w: ["Ù„ÙØ§", "Ø´ÙÙŠÙ’Ø¡", "Ø£ÙØºÙ’Ù„Ù‰", "Ù…ÙÙ†Ù", "Ø§Ù„Ù’ÙˆÙØ·ÙÙ†"]
    },
    {
        s: [
            "ØªÙÙ‚ÙØ¹Ù ØªÙØ±Ù’ÙƒÙÙŠØ§ Ø¨ÙÙŠÙ’Ù†Ù Ø¢Ø³Ù’ÙŠØ§ ÙˆÙØ£ÙÙˆØ±ÙˆØ¨Ù‘Ø§",
            "ØªÙÙ‚ÙØ¹Ù ØªÙØ±Ù’ÙƒÙÙŠØ§ Ø¨ÙÙŠÙ’Ù†Ù Ø£ÙÙˆØ±ÙˆØ¨Ù‘Ø§ ÙˆÙØ¢Ø³Ù’ÙŠØ§"
        ],
        w: ["ØªÙÙ‚ÙØ¹Ù", "ØªÙØ±Ù’ÙƒÙÙŠØ§", "Ø¨ÙÙŠÙ’Ù†Ù", "Ø¢Ø³Ù’ÙŠØ§", "ÙˆÙØ£ÙÙˆØ±ÙˆØ¨Ù‘Ø§"]
    },
    {
        s: [
            "Ø£ÙØ®Ù’Ø¯ÙÙ…Ù ÙˆÙØ·ÙÙ†ÙŠ Ø¨ÙØ¹ÙÙ„Ù’Ù…ÙŠ ÙˆÙØ¹ÙÙ…ÙÙ„ÙŠ",
            "Ø£ÙØ®Ù’Ø¯ÙÙ…Ù ÙˆÙØ·ÙÙ†ÙŠ Ø¨ÙØ¹ÙÙ…ÙÙ„ÙŠ ÙˆÙØ¹ÙÙ„Ù’Ù…ÙŠ"
        ],
        w: ["Ø£ÙØ®Ù’Ø¯ÙÙ…Ù", "ÙˆÙØ·ÙÙ†ÙŠ", "Ø¨ÙØ¹ÙÙ„Ù’Ù…ÙŠ", "ÙˆÙØ¹ÙÙ…ÙÙ„ÙŠ"]
    },
    {
        s: ["Ø£ÙØ±ÙŠØ¯Ù ØªÙØ°Ù’ÙƒÙØ±ÙØ© Ù„ÙÙ„Ù‚ÙØ·Ø§Ø± Ø§Ù„Ø³ÙÙ‘Ø±ÙŠØ¹"],
        w: ["Ø£ÙØ±ÙŠØ¯Ù", "ØªÙØ°Ù’ÙƒÙØ±ÙØ©", "Ù„ÙÙ„Ù‚ÙØ·Ø§Ø±", "Ø§Ù„Ø³ÙÙ‘Ø±ÙŠØ¹"]
    },
    {
        s: ["ÙƒÙÙ… Ø³Ø§Ø¹ÙØ© ØªÙØ³Ù’ØªÙØºÙ’Ø±ÙÙ‚Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù„ÙØ©ØŸ"],
        w: ["ÙƒÙÙ…", "Ø³Ø§Ø¹ÙØ©", "ØªÙØ³Ù’ØªÙØºÙ’Ø±ÙÙ‚Ù", "Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù„ÙØ©ØŸ"]
    },
    {
        s: ["Ø³ÙØ£ÙØ³Ø§ÙÙØ±Ù Ø¥ÙÙ„Ù‰ Ø¥ÙØ³Ù’Ø·ÙÙ†Ù’Ø¨ÙˆÙ„ Ø¨ÙØ§Ù„Ø·Ù‘Ø§Ø¦ÙØ±ÙØ©"],
        w: ["Ø³ÙØ£ÙØ³Ø§ÙÙØ±Ù", "Ø¥ÙÙ„Ù‰", "Ø¥ÙØ³Ù’Ø·ÙÙ†Ù’Ø¨ÙˆÙ„", "Ø¨ÙØ§Ù„Ø·Ù‘Ø§Ø¦ÙØ±ÙØ©"]
    },
    {
        s: ["Ø§Ù„Ø´Ù‘Ø§Ø±ÙØ¹ Ù…ÙØ²Ù’Ø¯ÙØ­ÙÙ… Ø¨ÙØ§Ù„Ù…ÙÙˆØ§ØµÙÙ„Ø§Øª"],
        w: ["Ø§Ù„Ø´Ù‘Ø§Ø±ÙØ¹", "Ù…ÙØ²Ù’Ø¯ÙØ­ÙÙ…", "Ø¨ÙØ§Ù„Ù…ÙÙˆØ§ØµÙÙ„Ø§Øª"]
    },
    {
        s: ["ÙˆÙØµÙÙ„Ù Ø§Ù„Ù‚ÙØ·Ø§Ø± Ø§Ù„Ø³ÙÙ‘Ø±ÙŠØ¹ Ø¥ÙÙ„Ù‰ Ø§Ù„Ù…ÙØ­ÙØ·ÙÙ‘Ø©"],
        w: ["ÙˆÙØµÙÙ„Ù", "Ø§Ù„Ù‚ÙØ·Ø§Ø±", "Ø§Ù„Ø³ÙÙ‘Ø±ÙŠØ¹", "Ø¥ÙÙ„Ù‰", "Ø§Ù„Ù…ÙØ­ÙØ·ÙÙ‘Ø©"]
    },
    {
        s: ["Ø§ÙÙ…Ù’Ø´Ù Ù‚ÙÙ„ÙŠÙ„Ù‹Ø§ ÙˆÙØ§ØªÙÙ‘Ø¬ÙÙ‡Ù’ Ø¥ÙÙ„Ù‰ Ø§Ù„ÙŠÙÙ…ÙŠÙ†"],
        w: ["Ø§ÙÙ…Ù’Ø´Ù", "Ù‚ÙÙ„ÙŠÙ„Ù‹Ø§", "ÙˆÙØ§ØªÙÙ‘Ø¬ÙÙ‡Ù’", "Ø¥ÙÙ„Ù‰", "Ø§Ù„ÙŠÙÙ…ÙŠÙ†"]
    },
    {
        s: ["Ø£ÙÙ‚ÙÙÙ Ø¹ÙÙ†Ù’Ø¯ Ø§Ù„Ø¶ÙÙ‘ÙˆÙ’Ø¡ Ø§Ù„Ø£ÙØ­Ù’Ù…ÙØ±"],
        w: ["Ø£ÙÙ‚ÙÙÙ", "Ø¹ÙÙ†Ù’Ø¯", "Ø§Ù„Ø¶ÙÙ‘ÙˆÙ’Ø¡", "Ø§Ù„Ø£ÙØ­Ù’Ù…ÙØ±"]
    },
    {
        s: ["Ø£ÙØ¹Ù’Ø¨ÙØ±Ù Ø¹ÙÙ†Ù’Ø¯ Ø§Ù„Ø¶ÙÙ‘ÙˆÙ’Ø¡ Ø§Ù„Ø£ÙØ®Ù’Ø¶ÙØ±"],
        w: ["Ø£ÙØ¹Ù’Ø¨ÙØ±Ù", "Ø¹ÙÙ†Ù’Ø¯", "Ø§Ù„Ø¶ÙÙ‘ÙˆÙ’Ø¡", "Ø§Ù„Ø£ÙØ®Ù’Ø¶ÙØ±"]
    },
    {
        s: ["Ù‡ÙØ°Ø§ Ø§Ù„Ù‚ÙØ·Ø§Ø± Ø£ÙØ³Ù’Ø±ÙØ¹ Ù…ÙÙ† Ø§Ù„Ø³ÙÙ‘ÙŠÙ‘Ø§Ø±ÙØ©"],
        w: ["Ù‡ÙØ°Ø§", "Ø§Ù„Ù‚ÙØ·Ø§Ø±", "Ø£ÙØ³Ù’Ø±ÙØ¹", "Ù…ÙÙ†", "Ø§Ù„Ø³ÙÙ‘ÙŠÙ‘Ø§Ø±ÙØ©"]
    },
    {
        s: ["Ø£ÙØ±ÙŠØ¯Ù ØºÙØ±Ù’ÙÙØ© Ù…ÙÙ†Ø§Ø³ÙØ¨ÙØ© ÙÙŠ Ø§Ù„ÙÙÙ†Ù’Ø¯ÙÙ‚"],
        w: ["Ø£ÙØ±ÙŠØ¯Ù", "ØºÙØ±Ù’ÙÙØ©", "Ù…ÙÙ†Ø§Ø³ÙØ¨ÙØ©", "ÙÙŠ", "Ø§Ù„ÙÙÙ†Ù’Ø¯ÙÙ‚"]
    }
];

        const activityArea = document.getElementById('activity-area');
        const instructionText = document.getElementById('instruction-text');
        const progressDisplay = document.getElementById('progress-display');
        const progressBar = document.getElementById('progress-bar');
        const colorPalette = ['#007bff', '#dc3545', '#28a745', '#ffc107', '#17a2b8', '#6f42c1', '#fd7e14'];

        let audioCtx = null;
        let activityQueue = [];
        let currentActivityIndex = 0;
        let grandTotalActivities = 0; 
        let scoreCorrect = 0;
        let scoreIncorrect = 0;
        let currentTour = 1; 
        
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => console.error(err));
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }

        function initAudioContext() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        
        function playSound(type) {
            if (!audioCtx) return; 
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'touch') { 
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(200, now);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.1);
                oscillator.start(now);
                oscillator.stop(now + 0.1);
            } else if (type === 'correct') { 
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(440, now);
                oscillator.frequency.linearRampToValueAtTime(880, now + 0.2); 
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.2);
                oscillator.start(now);
                oscillator.stop(now + 0.2);
            } else if (type === 'incorrect') { 
                oscillator.type = 'square'; 
                oscillator.frequency.setValueAtTime(164.81, now); 
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.2); 
                oscillator.start(now);
                oscillator.stop(now + 0.2); 
            }
        }
        
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createActivityQueue() {
            const sortedByLength = [...activitiesData].sort((a, b) => a.w.length - b.w.length);
            const shortSentences = sortedByLength.slice(0, 10);
            const longSentences = sortedByLength.slice(10, 20);

            if (currentTour === 1) {
                activityQueue = shuffle([...shortSentences]);
            } else {
                if (currentTour > 2) {
                    currentTour = 1;
                    activityQueue = shuffle([...shortSentences]);
                } else {
                    activityQueue = shuffle([...longSentences]);
                }
            }
            
            grandTotalActivities = activityQueue.length;
            if (grandTotalActivities === 0) {
                 activityQueue = shuffle([...activitiesData]); 
                 grandTotalActivities = activityQueue.length;
            }
        }

        function loadActivity() {
            activityArea.innerHTML = '';
            updateProgress();
            
            const activityData = activityQueue[currentActivityIndex]; 
            instructionText.textContent = "Ø±ÙØªÙÙ‘Ø¨ Ø§Ù„ÙƒÙÙ„ÙÙ…Ø§Øª Ù„ÙØªÙÙƒÙ’ÙˆÙŠÙ† Ø¬ÙÙ…Ù’Ù„ÙØ©â€«.â€¬";
            buildScramble(activityData);
        }
        
        function updateButtonState() {
            const dragZone = document.getElementById('drag-zone');
            const dropZone = document.getElementById('drop-zone');
            const checkBtn = document.getElementById('check-scramble-btn');
            const resetBtn = document.getElementById('reset-scramble-btn');

            if (!dragZone || !dropZone || !checkBtn || !resetBtn) return;

            const isAllMoved = dragZone.children.length === 0;
            if (isAllMoved) {
                checkBtn.classList.remove('disabled-btn');
            } else {
                checkBtn.classList.add('disabled-btn');
            }

            const isAnyMoved = dropZone.children.length > 0;
            if (isAnyMoved) {
                resetBtn.classList.remove('disabled-btn');
            } else {
                resetBtn.classList.add('disabled-btn');
            }
        }

        function handleWordClick(e) {
            const wordItem = e.currentTarget; 
            if (wordItem.draggable === false) return;
            const dropZone = document.getElementById('drop-zone');
            const dragZone = document.getElementById('drag-zone');
            
            if (wordItem.parentElement === dragZone) {
                dropZone.appendChild(wordItem);
            } else if (wordItem.parentElement === dropZone) {
                dragZone.appendChild(wordItem);
            }
            playSound('touch'); 
            
            updateButtonState();
        }

        function buildScramble(data) {
            const scrambleContainer = document.createElement('div');
            scrambleContainer.className = 'scramble-container';

            const dropZone = document.createElement('div');
            dropZone.id = 'drop-zone';
            dropZone.className = 'drop-zone';

            const dragZone = document.createElement('div');
            dragZone.id = 'drag-zone';
            dragZone.className = 'drag-zone';

            const correctOrderWords = data.s[0].split(' ');
            let wordObjects = correctOrderWords.map((wordText, index) => {
                return {
                    text: wordText,
                    color: colorPalette[index % colorPalette.length], 
                    id: `word-obj-${index}` 
                };
            });

            const shuffledObjects = shuffle([...wordObjects]);

            shuffledObjects.forEach((obj) => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                wordItem.textContent = obj.text;
                wordItem.id = obj.id; 
                wordItem.draggable = true;
                wordItem.style.backgroundColor = obj.color; 
                wordItem.addEventListener('click', handleWordClick);
                dragZone.appendChild(wordItem);
            });

            const controls = document.createElement('div');
            controls.className = 'scramble-controls';
            
            const checkButton = document.createElement('button');
            checkButton.id = 'check-scramble-btn';
            checkButton.textContent = 'âœ” ØªÙØ­ÙÙ‚ÙÙ‘Ù‚Ù’';
            checkButton.classList.add('disabled-btn');
            checkButton.onclick = () => {
                playSound('touch');
                checkScrambleAnswer(data.s); 
            };
            
            const resetButton = document.createElement('button');
            resetButton.id = 'reset-scramble-btn';
            resetButton.textContent = 'ğŸ”„ Ø¥ÙØ¹Ø§Ø¯ÙØ©';
            resetButton.classList.add('disabled-btn'); 
            resetButton.onclick = () => {
                playSound('touch');
                document.getElementById('hint-btn').style.visibility = 'hidden'; 
                loadActivity(); 
            };

            const hintButton = document.createElement('button');
            hintButton.id = 'hint-btn';
            hintButton.textContent = 'ğŸ’¡'; 
            hintButton.onclick = () => {
                playSound('touch');
                solvePuzzleAnimation(data.s[0]); 
            };
            
            const nextButton = document.createElement('button');
            nextButton.id = 'next-activity-btn';
            nextButton.style.display = 'none'; 
            nextButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11h12.17l-5.59-5.59L12 4l8 8-8 8-1.41-1.41L16.17 13H4v-2z"/></svg>`; 
            nextButton.onclick = () => {
                playSound('touch');
                nextActivity();
            };

            controls.appendChild(hintButton); 
            controls.appendChild(checkButton);
            controls.appendChild(resetButton);
            controls.appendChild(nextButton); 
            
            scrambleContainer.appendChild(dropZone);
            scrambleContainer.appendChild(dragZone);
            scrambleContainer.appendChild(controls);
            
            activityArea.appendChild(scrambleContainer);

            addDragDropListeners();
        }
        
        function toggleWordDrag(enable) {
            document.querySelectorAll('.word-item').forEach(item => {
                item.draggable = enable;
                item.style.cursor = enable ? 'grab' : 'default'; 
                if (!enable) item.classList.remove('dragging'); 
            });
        }

        function checkScrambleAnswer(correctAnswers) {
            const dropZone = document.getElementById('drop-zone');
            const words = Array.from(dropZone.children).map(item => item.textContent);
            const userAnswer = words.join(' ');
            
            const cleanUserAnswer = userAnswer.replace(/\.$/, '');
            const cleanCorrectAnswers = correctAnswers.map(s => s.replace(/\.$/, ''));
            const isCorrect = cleanCorrectAnswers.includes(cleanUserAnswer);
            
            dropZone.classList.remove('drop-zone-correct', 'drop-zone-incorrect');
            
            if (isCorrect) {
                scoreCorrect++;
                playSound('correct'); 
                dropZone.classList.add('drop-zone-correct'); 
                
                document.getElementById('check-scramble-btn').style.display = 'none';
                document.getElementById('reset-scramble-btn').style.display = 'none';
                
                const hintBtn = document.getElementById('hint-btn');
                if(hintBtn) hintBtn.style.visibility = 'hidden';

                document.getElementById('next-activity-btn').style.display = 'flex';
                
                toggleWordDrag(false); 
                
            } else {
                scoreIncorrect++;
                playSound('incorrect'); 
                dropZone.classList.add('drop-zone-incorrect');
                
                const hintBtn = document.getElementById('hint-btn');
                if (hintBtn) hintBtn.style.visibility = 'visible';
                
                setTimeout(() => {
                    dropZone.classList.remove('drop-zone-incorrect');
                }, 400);
            }
        }

        function solvePuzzleAnimation(correctSentenceStr) {
            const dropZone = document.getElementById('drop-zone');
            const allCards = Array.from(document.querySelectorAll('.word-item'));
            const hintBtn = document.getElementById('hint-btn');

            document.body.style.pointerEvents = 'none';
            hintBtn.style.visibility = 'hidden'; 

            const positions = new Map();
            allCards.forEach(card => {
                const rect = card.getBoundingClientRect();
                positions.set(card.id, { left: rect.left, top: rect.top });
            });

            correctSentenceStr.split(' ').forEach((_, i) => {
                const card = document.getElementById(`word-obj-${i}`);
                dropZone.appendChild(card); 
            });

            allCards.forEach(card => {
                const oldPos = positions.get(card.id);
                const newRect = card.getBoundingClientRect(); 

                const deltaX = oldPos.left - newRect.left;
                const deltaY = oldPos.top - newRect.top;

                card.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
                card.style.transition = 'none'; 
            });

            requestAnimationFrame(() => {
                allCards.forEach(card => {
                    card.style.transition = 'transform 2.5s cubic-bezier(0.25, 1, 0.5, 1)';
                    card.style.transform = 'translate(0, 0)';
                    card.style.zIndex = '100'; 
                });
            });

            setTimeout(() => {
                allCards.forEach(card => {
                    card.style.transition = '';
                    card.style.transform = '';
                    card.style.zIndex = '';
                });
                
                document.body.style.pointerEvents = 'auto';
                checkScrambleAnswer([correctSentenceStr]);
            }, 2500); 
        }

        function nextActivity() {
            currentActivityIndex++; 
            if (currentActivityIndex === grandTotalActivities) {
                showFinishScreen();
            } else {
                loadActivity();
            }
        }

        function showFinishScreen() {
            activityArea.innerHTML = `
                <div id="finish-screen">
                    <p>Ø£ÙØ­Ù’Ø³ÙÙ†Ù’Øª! Ù„ÙÙ‚ÙØ¯ Ø£ÙÙƒÙ’Ù…ÙÙ„Ù’ØªÙ Ø¬ÙÙ…ÙŠØ¹ Ø§Ù„Ø£ÙÙ†Ù’Ø´ÙØ·ÙØ©â€«.â€¬</p>
                    <div class="score-display">
                        <span class="score-item score-correct">âœ” ${scoreCorrect}</span>
                        <span class="score-item score-incorrect">âŒ ${scoreIncorrect}</span>
                    </div>
                    <button id="replay-button" onclick="restartGame()">ğŸ”„</button>
                </div>
            `;
            instructionText.textContent = "Ø§ÙÙ†Ù’ØªÙÙ‡ÙØª Ø§Ù„Ø£ÙÙ†Ù’Ø´ÙØ·ÙØ©";
            progressDisplay.textContent = "Ø§ÙÙƒÙ’ØªÙÙ…ÙÙ„";
            progressBar.style.width = '100%';
            progressBar.style.backgroundColor = 'var(--success-color)';
        }
        
        function restartGame() {
            playSound('touch');
            scoreCorrect = 0;
            scoreIncorrect = 0;
            currentActivityIndex = 0; 
            currentTour++; 
            
            progressBar.style.width = '0%';
            progressBar.style.backgroundColor = 'var(--accent-color)';
            
            createActivityQueue(); 
            loadActivity(); 
        }

        function updateProgress() {
            if (grandTotalActivities === 0) { progressDisplay.textContent = `0 / 10`; return; }
            if (currentActivityIndex === grandTotalActivities) return; 
            const currentQuestionNum = currentActivityIndex + 1;
            const progressPercent = (currentActivityIndex / grandTotalActivities) * 100;
            progressDisplay.textContent = `${currentQuestionNum} / ${grandTotalActivities}`;
            progressBar.style.width = `${progressPercent}%`;
        }
        
        function addDragDropListeners() {
            const draggables = document.querySelectorAll('.word-item');
            const containers = [document.getElementById('drop-zone'), document.getElementById('drag-zone')];

            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', (e) => {
                    if (!e.currentTarget.draggable) { e.preventDefault(); return; }
                    e.currentTarget.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', e.currentTarget.id);
                });
                draggable.addEventListener('dragend', (e) => { e.currentTarget.classList.remove('dragging'); });
            });

            containers.forEach(container => {
                container.addEventListener('dragover', (e) => { e.preventDefault(); });
                
                container.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const id = e.dataTransfer.getData('text/plain');
                    const draggable = document.getElementById(id);
                    if (draggable && draggable.draggable) { 
                        container.appendChild(draggable);
                        draggable.classList.remove('dragging');
                        
                        updateButtonState();
                    }
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            activitiesData.forEach(round => {
                round.w = round.w.map(word => word.trim().replace(/\.$/, ''));
                round.s = round.s.map(s_item => s_item.trim().replace(/\.$/, ''));
            });
            
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            if (fullscreenBtn) fullscreenBtn.addEventListener('click', toggleFullScreen);
            document.addEventListener('fullscreenchange', () => {
                if (document.fullscreenElement) document.body.classList.add('fullscreen');
                else document.body.classList.remove('fullscreen');
            });
            
            createActivityQueue(); 
            loadActivity();
        });
    </script> 
    <script src="https://cdn.jsdelivr.net/npm/drag-drop-touch@1.3.1/DragDropTouch.js"></script>
</body>
</html>