<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‚ÙŠÙ…ÙŠ - ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Responsive)</title>
    <link href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Temel Sayfa Stilleri --- */
        :root {
            --accent-color: #007bff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --bg-light: #f8f9fa;
            --font-arabic: 'Markazi Text', 'Tahoma', 'Arial', sans-serif;
        }

        body {
            font-family: var(--font-arabic);
            background-color: #e9ecef;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Sayfa kaymasÄ±nÄ± engelle */
        }

        /* --- Ana Etkinlik AlanÄ± (Responsive Kutu) --- */
        .activity-container {
            position: relative;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            
            /* VarsayÄ±lan GeniÅŸlik/YÃ¼kseklik (MasaÃ¼stÃ¼) */
            width: 90vw;
            height: 85vh; 
            max-width: 1200px;
            transition: all 0.3s ease;
        }

        /* --- Header (BaÅŸlÄ±k ve Ä°lerleme) --- */
        .header {
            padding: 10px 20px;
            border-bottom: 1px solid #dee2e6;
            display: grid;
            grid-template-areas: "progress instruction back";
            grid-template-columns: 1fr 2fr 1fr; /* Ä°lerleme - BaÅŸlÄ±k - Butonlar */
            align-items: center;
            gap: 10px;
            background: #fff;
            z-index: 10;
            flex-shrink: 0;
        }
        
        #instruction-text { 
            grid-area: instruction;
            text-align: center; 
            font-size: clamp(1.5rem, 2.5vw, 2.2rem); 
            font-weight: 700;
            color: #555;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .progress-container { 
            grid-area: progress;
            display: flex;
            align-items: center;
            gap: 10px;
            direction: ltr; /* Ä°lerleme Ã§ubuÄŸu soldan saÄŸa */
        }
        #progress-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-color);
            min-width: 50px;
        }
        .progress-bar-container {
            flex-grow: 1;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--accent-color);
            transition: width 0.4s ease;
        }

        /* --- Butonlar (Geri ve Tam Ekran) --- */
        .back-button-container {
            grid-area: back;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .back-button, #fullscreen-btn {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            text-decoration: none;
        }
        .back-button:hover, #fullscreen-btn:hover { background: #e0e0e0; }
        .back-button svg, #fullscreen-btn svg { width: 24px; height: 24px; fill: currentColor; }
        
        /* Tam ekran ikon deÄŸiÅŸimi */
        #fullscreen-btn .icon-open { display: block; }
        #fullscreen-btn .icon-close { display: none; }
        body.fullscreen #fullscreen-btn .icon-open { display: none; }
        body.fullscreen #fullscreen-btn .icon-close { display: block; }

        /* --- Soru ve ÅÄ±klar AlanÄ± --- */
        .activity-area {
            flex-grow: 1;
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
        }
        
        .quiz-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
        }

        .question {
            font-size: clamp(2rem, 5vw, 4rem);
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            color: #212529;
            line-height: 1.3;
        }

        .options {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .option {
            width: 100%;
            max-width: 600px; /* Ã‡ok geniÅŸ ekranlarda yayÄ±lmasÄ±n */
            padding: 12px 10px;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-family: var(--font-arabic);
            background-color: var(--bg-light);
            border: 2px solid #ced4da;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            box-sizing: border-box;
        }
        .option:hover {
            border-color: var(--accent-color);
            background-color: #eef5ff;
        }

        /* --- Geri Bildirim Overlay --- */
        .feedback-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 8rem;
            z-index: 200;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: inherit;
        }
        .feedback-overlay.show { visibility: visible; opacity: 1; }
        .feedback-overlay .correct { color: var(--success-color); }
        .feedback-overlay .incorrect { color: var(--danger-color); }
        
        /* --- BitiÅŸ EkranÄ± --- */
        #finish-screen {
            text-align: center;
            font-weight: 700;
            color: var(--accent-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        #finish-screen p { font-size: clamp(2rem, 5vw, 3.5rem); margin: 10px 0; }
        .score-display { display: flex; gap: 30px; font-size: 3rem; margin: 20px 0; direction: ltr; }
        .score-correct { color: var(--success-color); }
        .score-incorrect { color: var(--danger-color); }
        #replay-button {
            font-size: 4rem;
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: transform 0.2s ease;
        }
        #replay-button:hover { transform: rotate(-90deg); background-color: #f0f0f0; }

        /* =========================================
           MEDYA SORGULARI (RESPONSIVE AYARLAR)
           ========================================= */

        /* 1. MOBÄ°L YATAY (LANDSCAPE) - YÃ¼kseklik az ise 2 sÃ¼tun yap */
        @media (max-height: 600px) {
            .header { padding: 5px 15px; }
            .activity-container { width: 95vw; height: 90vh; }
            .question { margin-bottom: 10px; font-size: 2rem; }
            
            .options {
                display: grid;
                grid-template-columns: 1fr 1fr; /* Ä°KÄ° SÃœTUN */
                gap: 8px;
                width: 100%;
            }
            .option {
                font-size: 1.6rem;
                padding: 8px;
                max-width: none;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            /* 5 ÅŸÄ±k varsa sonuncuyu ortala */
            .options .option:last-child:nth-child(odd) { grid-column: span 2; }
        }

        /* 2. MOBÄ°L DÄ°KEY (PORTRAIT) - Dar ekranlar */
        @media (orientation: portrait) and (max-width: 768px) {
            .activity-container {
                width: 95vw;
                height: 90vh;
                max-height: none;
            }

            .header {
                grid-template-areas: 
                    "progress back"
                    "instruction instruction";
                grid-template-columns: 1fr auto;
                gap: 5px;
                padding: 5px 10px; /* Header kÃ¼Ã§Ã¼ldÃ¼ */
            }
            
            #instruction-text {
                font-size: 1.5rem;
                padding-top: 2px;
            }

            .question {
                font-size: 2.2rem;
                margin-top: 5px;
                margin-bottom: 10px; /* Soru altÄ± boÅŸluk azaldÄ± */
            }

            .options {
                gap: 6px; /* Ä°STEDÄ°ÄÄ°NÄ°Z: ÅÄ±klar arasÄ± boÅŸluk azaltÄ±ldÄ± */
                width: 100%;
            }

            .option {
                font-size: 1.8rem; /* Okunabilir boyut */
                padding: 8px 5px;  /* Ä°STEDÄ°ÄÄ°NÄ°Z: Kutu iÃ§i boÅŸluk azaltÄ±ldÄ± */
                width: 100%;
                min-height: auto;
                line-height: 1.2;
            }
        }

        /* --- TAM EKRAN MODU (Ã–ZEL) --- */
        body.fullscreen .activity-container {
            width: 100vw !important;
            height: 100vh !important;
            max-width: 100vw !important;
            max-height: 100vh !important;
            border-radius: 0;
            box-shadow: none;
            margin: 0;
        }
        
        body.fullscreen.portrait .header {
            padding-top: 20px; /* Ã‡entik payÄ± */
        }
    </style>
</head>
<body>

    <div class="activity-container">
        <div class="header">
            <div class="progress-container">
                <div id="progress-display">0 / 0</div> 
                <div class="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
            </div>
            <div id="instruction-text">...</div>
            
            <div class="back-button-container">
                <button id="fullscreen-btn">
                    <svg class="icon-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 10h2V7h3V5H5v5zM14 5v2h3v3h2V5h-5zM5 19v-5h2v3h3v2H5zM14 19v-2h3v-3h2v5h-5z"/>
                    </svg>
                    <svg class="icon-close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
                    </svg>
                </button>
                
                <a href="index.html" class="back-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </a>
            </div>
        </div> 
        
        <div class="activity-area" id="activity-area"></div>

        <div id="feedback-overlay" class="feedback-overlay">
            <div id="feedback-icon"></div>
        </div>
    </div>

   <script>
        // --- ETKÄ°NLÄ°K VERÄ°LERÄ° ---
       const activitiesData = [
    {
        title: "Unit 3",
        quiz: [
            { q: "ÙŠÙˆÙ†ÙØ³: Ø£ÙØ¹ÙŠØ´Ù ÙÙŠ ............... Ù‚ÙˆÙ†Ù’ÙŠØ§.", o: ["Ø¨ÙØ­Ù’Ø±", "Ù…ÙØ¯ÙŠÙ†ÙØ©", "Ø¬ÙØ¨ÙÙ„", "Ù‚ÙÙ„ÙÙ…", "Ø­ÙØ¯ÙŠÙ‚ÙØ©"], a: 1 },
            { q: "ØªÙØ´Ù’ØªÙÙ‡ÙØ±Ù Ù‚ÙˆÙ†Ù’ÙŠØ§ Ø¨ÙÙ€............... Ù…ÙÙˆÙ’Ù„Ø§Ù†Ø§.", o: ["Ù…ÙØªÙ’Ø­ÙÙ", "Ù…ÙØ·Ù’Ø¹ÙÙ…", "Ù…ÙØ³Ù’ØªÙØ´Ù’ÙÙ‰", "Ù…ÙØ·Ø§Ø±", "Ù…ÙØ¯Ù’Ø±ÙØ³ÙØ©"], a: 0 },
            { q: "ØªÙÙ‚ÙØ¹Ù Ø£ÙÙ†Ù’Ù‚ÙØ±ÙØ© ÙÙŠ ............... ØªÙØ±Ù’ÙƒÙÙŠØ§.", o: ["ØªÙØ­Ù’Øª", "ÙÙÙˆÙ’Ù‚", "ÙˆÙØ³ÙØ·", "Ø®ÙÙ„Ù’Ù", "Ø£ÙÙ…Ø§Ù…"], a: 2 },
            { q: "ØªÙØ¬ÙÙˆÙÙ‘Ù„Ù’ØªÙ ÙÙŠ ............... Ø§Ù„Ø£ÙØ³Ù’Ù…Ø§Ùƒ ÙÙŠ Ø£ÙˆØ±Ù’ÙÙØ©.", o: ["Ù‚ÙÙ„Ù’Ø¹ÙØ©", "Ø¨ÙØ­ÙÙŠÙ’Ø±ÙØ©", "Ø¬ÙØ¨ÙÙ„", "Ø¨ÙÙŠÙ’Øª", "Ø³ÙÙˆÙ‚"], a: 1 },
            { q: "Ø²ÙØ±Ù’ØªÙ ............... Ø¢ÙŠØ§ØµÙˆÙÙ’ÙŠØ§ Ø§Ù„ÙƒÙØ¨ÙŠØ± ÙÙŠ Ø¥ÙØ³Ù’Ø·ÙÙ†Ù’Ø¨ÙˆÙ„.", o: ["Ù…ÙØ¯Ù’Ø±ÙØ³ÙØ©", "Ø³ÙÙˆÙ‚", "Ù…ÙØ³Ù’Ø¬ÙØ¯", "ÙÙÙ†Ù’Ø¯ÙÙ‚", "Ù‚ÙØµÙ’Ø±"], a: 2 },
            { q: "ØªÙÙ‚ÙØ¹Ù Ø·ÙØ±Ø§Ø¨Ù’Ø²ÙˆÙ† ÙÙŠ ............... ØªÙØ±Ù’ÙƒÙÙŠØ§.", o: ["Ø´ÙÙ…Ø§Ù„", "Ø¬ÙÙ†ÙˆØ¨", "ØºÙØ±Ù’Ø¨", "ÙˆÙØ³ÙØ·", "Ø´ÙØ±Ù’Ù‚"], a: 0 },
            { q: "ØªÙÙ‚ÙØ¹Ù Ù…ÙØ±Ù’Ø³ÙŠÙ† ÙÙŠ ............... ØªÙØ±Ù’ÙƒÙÙŠØ§.", o: ["Ø´ÙØ±Ù’Ù‚", "Ø´ÙÙ…Ø§Ù„", "Ø¬ÙÙ†ÙˆØ¨", "ÙˆÙØ³ÙØ·", "ØºÙØ±Ù’Ø¨"], a: 2 },
            { q: "Ù„ÙØ§ Ø´ÙÙŠÙ’Ø¡ ............... Ù…ÙÙ†Ù Ø§Ù„Ù’ÙˆÙØ·ÙÙ†.", o: ["Ø±ÙØ®ÙŠØµ", "Ø£ÙØºÙ’Ù„Ù‰", "ØµÙØºÙŠØ±", "Ù‚ÙØ¨ÙŠØ­", "Ù‚ÙØ±ÙŠØ¨"], a: 1 },
            { q: "ØªÙÙ‚ÙØ¹Ù ØªÙØ±Ù’ÙƒÙÙŠØ§ Ø¨ÙÙŠÙ’Ù†Ù Ø¢Ø³Ù’ÙŠØ§ ÙˆÙ ............... .", o: ["Ø¥ÙÙÙ’Ø±ÙŠÙ‚Ù’ÙŠØ§", "Ø£ÙÙ…Ù’Ø±ÙŠÙƒØ§", "Ø£ÙÙˆØ±ÙˆØ¨Ù‘Ø§", "Ø£ÙÙ†Ù’ØªØ§Ø±Ù’ÙƒÙ’ØªÙŠÙƒØ§", "Ø£ÙØ³Ù’ØªÙØ±Ø§Ù„Ù’ÙŠØ§"], a: 2 },
            { q: "Ø£ÙØ®Ù’Ø¯ÙÙ…Ù ÙˆÙØ·ÙÙ†ÙŠ Ø¨ÙÙ€ ............... ÙˆÙØ¹ÙÙ…ÙÙ„ÙŠ.", o: ["Ø£ÙÙƒÙ’Ù„ÙŠ", "Ù†ÙÙˆÙ’Ù…ÙŠ", "Ù„ÙØ¹ÙØ¨ÙŠ", "Ø¹ÙÙ„Ù’Ù…ÙŠ", "Ø´ÙØ±Ù’Ø¨ÙŠ"], a: 3 },
            { q: "Ø£ÙØ±ÙŠØ¯Ù ............... Ù„ÙÙ„Ù‚ÙØ·Ø§Ø± Ø§Ù„Ø³ÙÙ‘Ø±ÙŠØ¹.", o: ["ÙƒÙØªØ§Ø¨", "Ø¯ÙÙÙ’ØªÙØ±", "ØªÙØ°Ù’ÙƒÙØ±ÙØ©", "Ø·ÙØ¹Ø§Ù…", "Ù‚ÙÙ„ÙÙ…"], a: 2 },
            { q: "ÙƒÙÙ… ............... ØªÙØ³Ù’ØªÙØºÙ’Ø±ÙÙ‚Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù„ÙØ©ØŸ", o: ["ÙƒÙÙŠÙ„Ùˆ", "Ù„ÙÙŠØ±ÙØ©", "Ø³Ø§Ø¹ÙØ©", "Ù‚ÙÙ„ÙÙ…", "Ù…ÙØªÙ’Ø±"], a: 2 },
            { q: "Ø³ÙØ£ÙØ³Ø§ÙÙØ±Ù Ø¥ÙÙ„Ù‰ Ø¥ÙØ³Ù’Ø·ÙÙ†Ù’Ø¨ÙˆÙ„ Ø¨ÙÙ€ ............... .", o: ["Ø§Ù„Ø·Ù‘Ø§Ø¦ÙØ±ÙØ©", "Ø§Ù„Ù…ÙØ¯Ù’Ø±ÙØ³ÙØ©", "Ø§Ù„Ø¨ÙÙŠÙ’Øª", "Ø§Ù„Ù…ÙÙ„Ù’Ø¹ÙØ¨", "Ø§Ù„Ø­ÙØ¯ÙŠÙ‚ÙØ©"], a: 0 },
            { q: "Ø§Ù„Ø´Ù‘Ø§Ø±ÙØ¹ ............... Ø¨ÙØ§Ù„Ù…ÙÙˆØ§ØµÙÙ„Ø§Øª.", o: ["Ø³ÙØ¹ÙŠØ¯", "Ù…ÙØ²Ù’Ø¯ÙØ­ÙÙ…", "Ø¬Ø§Ø¦Ø¹", "Ù†Ø§Ø¦ÙÙ…", "Ø®Ø§Ù„Ù"], a: 1 },
            { q: "ÙˆÙØµÙÙ„Ù Ø§Ù„Ù‚ÙØ·Ø§Ø± Ø§Ù„Ø³ÙÙ‘Ø±ÙŠØ¹ Ø¥ÙÙ„Ù‰ ............... .", o: ["Ø§Ù„Ù…ÙØ­ÙØ·ÙÙ‘Ø©", "Ø§Ù„ØºÙØ±Ù’ÙÙØ©", "Ø§Ù„Ù…ÙØ·Ù’Ø¨ÙØ®", "Ø§Ù„Ø­ÙØ¯ÙŠÙ‚ÙØ©", "Ø§Ù„Ø³Ù‘ÙˆÙ‚"], a: 0 },
            { q: "Ø§ÙÙ…Ù’Ø´Ù Ù‚ÙÙ„ÙŠÙ„Ù‹Ø§ØŒ ÙˆÙØ§ØªÙÙ‘Ø¬ÙÙ‡Ù’ Ø¥ÙÙ„Ù‰ ............... .", o: ["Ø§Ù„ÙŠÙÙ…ÙŠÙ†", "Ø§Ù„Ø£ÙÙ…Ù’Ø³", "Ø§Ù„Ø³ÙÙ‘Ù…Ø§Ø¡", "Ø§Ù„Ù„ÙÙ‘ÙŠÙ’Ù„", "Ø§Ù„Ø¨ÙÙŠÙ’Øª"], a: 0 },
            { q: "Ø£ÙÙ‚ÙÙÙ Ø¹ÙÙ†Ù’Ø¯ Ø§Ù„Ø¶ÙÙ‘ÙˆÙ’Ø¡ ............... .", o: ["Ø§Ù„Ø£ÙØ®Ù’Ø¶ÙØ±", "Ø§Ù„Ø£ÙØ­Ù’Ù…ÙØ±", "Ø§Ù„Ø£ÙØ²Ù’Ø±ÙÙ‚", "Ø§Ù„Ø£ÙØ¨Ù’ÙŠÙØ¶", "Ø§Ù„Ø£ÙØµÙ’ÙÙØ±"], a: 1 },
            { q: "Ø£ÙØ¹Ù’Ø¨ÙØ±Ù Ø¹ÙÙ†Ù’Ø¯ Ø§Ù„Ø¶ÙÙ‘ÙˆÙ’Ø¡ ............... .", o: ["Ø§Ù„Ø£ÙØ®Ù’Ø¶ÙØ±", "Ø§Ù„Ø£ÙØ­Ù’Ù…ÙØ±", "Ø§Ù„Ø£ÙØ³Ù’ÙˆÙØ¯", "Ø§Ù„Ø¨ÙÙ†ÙÙ‘ÙŠÙ‘", "Ø§Ù„Ø£ÙØ²Ù’Ø±ÙÙ‚"], a: 0 },
            { q: "Ù‡ÙØ°Ø§ Ø§Ù„Ù‚ÙØ·Ø§Ø± ............... Ù…ÙÙ† Ø§Ù„Ø³ÙÙ‘ÙŠÙ‘Ø§Ø±ÙØ©.", o: ["Ø¨ÙØ·ÙŠØ¡", "Ù‚ÙØµÙŠØ±", "ØµÙØºÙŠØ±", "Ø£ÙØ³Ù’Ø±ÙØ¹", "Ø£ÙÙƒÙ’Ø¨ÙØ±"], a: 3 },
            { q: "Ø£ÙØ±ÙŠØ¯Ù ............... Ù…ÙÙ†Ø§Ø³ÙØ¨ÙØ© ÙÙŠ Ø§Ù„ÙÙÙ†Ù’Ø¯ÙÙ‚.", o: ["ØºÙØ±Ù’ÙÙØ©", "Ø´Ø§Ø±ÙØ¹", "Ø·Ø§Ø¦ÙØ±ÙØ©", "Ø³ÙÙÙÙŠÙ†ÙØ©", "Ø³ÙÙŠÙ‘Ø§Ø±ÙØ©"], a: 0 }
        ]
    }
];
        // --- Gerekli Elementler ---
        const activityArea = document.getElementById('activity-area');
        const instructionText = document.getElementById('instruction-text');
        const progressDisplay = document.getElementById('progress-display');
        const progressBar = document.getElementById('progress-bar');
        const feedbackOverlay = document.getElementById('feedback-overlay');
        const feedbackIcon = document.getElementById('feedback-icon');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        
        // --- Ses DeÄŸiÅŸkenleri ---
        let audioCtx = null;
        
        // --- Durum DeÄŸiÅŸkenleri ---
        let activityQueue = [];
        let currentActivityIndex = 0;
        let grandTotalActivities = 0;
        
        let scoreCorrect = 0;
        let scoreIncorrect = 0;
        let allRounds = []; 
        let currentRoundIndex = 0; 

        // --- SES FONKSÄ°YONLARI ---
        function initAudioContext() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        function playSound(type) {
            if (!audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            const now = audioCtx.currentTime;
            if (type === 'touch') {
                oscillator.frequency.setValueAtTime(200, now);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.1);
                oscillator.start(now);
                oscillator.stop(now + 0.1);
            } else if (type === 'correct') {
                oscillator.frequency.setValueAtTime(440, now);
                oscillator.frequency.linearRampToValueAtTime(880, now + 0.2);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.2);
                oscillator.start(now);
                oscillator.stop(now + 0.2);
            } else if (type === 'incorrect') {
                oscillator.frequency.setValueAtTime(300, now);
                oscillator.frequency.linearRampToValueAtTime(150, now + 0.3);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.3);
                oscillator.start(now);
                oscillator.stop(now + 0.3);
            }
        }
        
        document.body.addEventListener('click', initAudioContext, { once: true });
        
        // --- Fisher-Yates KarÄ±ÅŸtÄ±rma ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- RaundlarÄ± HazÄ±rla ---
        function prepareRounds() {
            // Veri: Index 0'daki 20 soru
            const allQuestions = activitiesData[0].quiz;
            // 20 soruyu ikiye bÃ¶lÃ¼yoruz (10 + 10)
            const round1 = allQuestions.slice(0, 10);
            const round2 = allQuestions.slice(10);
            allRounds = [round1, round2];
            currentRoundIndex = 0;
        }

        // --- Mevcut Raundu YÃ¼kle ---
        function loadCurrentRound() {
            if (currentRoundIndex >= allRounds.length) return;
            const currentRoundQuestions = allRounds[currentRoundIndex];
            activityQueue = shuffle([...currentRoundQuestions]); 
            grandTotalActivities = activityQueue.length;
            currentActivityIndex = 0;
        }

        // --- ETKÄ°NLÄ°K YÃœKLEYÄ°CÄ° ---
        function loadActivity() {
            activityArea.innerHTML = '';
            updateProgress();
            
            const activityData = activityQueue[currentActivityIndex]; 
            // HATALI KARAKTER TEMÄ°ZLENDÄ°:
            instructionText.textContent = "Ø§ÙØ®Ù’ØªÙØ± Ø§Ù„Ø¬ÙÙˆØ§Ø¨ Ø§Ù„ØµÙÙ‘Ø­ÙŠØ­.";
            buildQuiz(activityData);
        }

        // --- Test ArayÃ¼zÃ¼ ---
        function buildQuiz(data) {
            const quizContainer = document.createElement('div');
            quizContainer.className = 'quiz-container';

            const question = document.createElement('div');
            question.className = 'question';
            question.textContent = data.q;
            quizContainer.appendChild(question);

            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'options';
            
            const optionsToShuffle = data.o.map((optionText, index) => {
                return { text: optionText, isCorrect: (index === data.a) };
            });
            const shuffledOptions = shuffle(optionsToShuffle);
            
            shuffledOptions.forEach(option => {
                const optionButton = document.createElement('button');
                optionButton.className = 'option';
                optionButton.textContent = option.text;
                optionButton.onclick = () => {
                    playSound('touch');
                    checkQuizAnswer(option.isCorrect); 
                };
                optionsContainer.appendChild(optionButton);
            });
            quizContainer.appendChild(optionsContainer);
            activityArea.appendChild(quizContainer);
        }

        // --- Cevap KontrolÃ¼ ---
        function checkQuizAnswer(isCorrect) {
            showFeedback(isCorrect);
            if (isCorrect) {
                scoreCorrect++;
                setTimeout(nextActivity, 1200);
            } else {
                scoreIncorrect++;
            }
        }

        // --- Geri Bildirim ---
        function showFeedback(isCorrect) {
            if (isCorrect) {
                feedbackIcon.textContent = 'âœ”';
                feedbackIcon.className = 'correct';
                playSound('correct');
            } else {
                feedbackIcon.textContent = 'âŒ';
                feedbackIcon.className = 'incorrect';
                playSound('incorrect');
            }
            feedbackOverlay.classList.add('show');
            if (!isCorrect) {
                setTimeout(() => {
                    feedbackOverlay.classList.remove('show');
                }, 1200);
            }
        }

        // --- Sonraki Etkinlik ---
        function nextActivity() {
            feedbackOverlay.classList.remove('show');
            currentActivityIndex++; 

            if (currentActivityIndex === grandTotalActivities) {
                // Raund Bitti
                currentRoundIndex++;
                if (currentRoundIndex < allRounds.length) {
                    loadCurrentRound();
                    progressBar.style.width = '0%'; 
                    loadActivity();
                } else {
                    showFinishScreen();
                }
            } else {
                loadActivity();
            }
        }

        // --- BitiÅŸ EkranÄ± ---
        function showFinishScreen() {
            // HATALI KARAKTER TEMÄ°ZLENDÄ°:
            activityArea.innerHTML = `
                <div id="finish-screen">
                    <p>Ø£ÙØ­Ù’Ø³ÙÙ†Ù’Øª! Ù„ÙÙ‚ÙØ¯ Ø£ÙÙƒÙ’Ù…ÙÙ„Ù’ØªÙ Ø¬ÙÙ…ÙŠØ¹ Ø§Ù„Ø£ÙÙ†Ù’Ø´ÙØ·ÙØ©.</p>
                    <div class="score-display">
                        <span class="score-item score-correct">âœ” ${scoreCorrect}</span>
                        <span class="score-item score-incorrect">âŒ ${scoreIncorrect}</span>
                    </div>
                    <button id="replay-button" onclick="restartGame()">ğŸ”„</button>
                </div>
            `;
            instructionText.textContent = "Ø§ÙÙ†Ù’ØªÙÙ‡ÙØª Ø§Ù„Ø£ÙÙ†Ù’Ø´ÙØ·ÙØ©";
            progressDisplay.textContent = "Ø§ÙÙƒÙ’ØªÙÙ…ÙÙ„";
            progressBar.style.width = '100%';
            progressBar.style.backgroundColor = 'var(--success-color)';
        }
        
        // --- Yeniden BaÅŸlat ---
        window.restartGame = function() { // Global scope iÃ§in window
            playSound('touch');
            scoreCorrect = 0;
            scoreIncorrect = 0;
            currentRoundIndex = 0; 
            progressBar.style.width = '0%';
            progressBar.style.backgroundColor = 'var(--accent-color)';
            loadCurrentRound();
            loadActivity();
        }

        // --- Ä°lerleme GÃ¼ncelleme ---
        function updateProgress() {
            if (grandTotalActivities === 0) {
                 progressDisplay.textContent = `0 / 0`;
                return;
            }
            if (currentActivityIndex === grandTotalActivities) return;
            const currentTotal = currentActivityIndex + 1;
            const percentage = (currentActivityIndex / grandTotalActivities) * 100;
            progressDisplay.textContent = `${currentTotal} / ${grandTotalActivities}`;
            progressBar.style.width = `${percentage}%`;
        }
        
        // --- TAM EKRAN MANTIÄI ---
        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`Hata: ${err.message}`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        });

        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                document.body.classList.add('fullscreen');
            } else {
                document.body.classList.remove('fullscreen');
            }
        });

        // --- BaÅŸlangÄ±Ã§ ---
        document.addEventListener('DOMContentLoaded', () => {
            if(activitiesData && activitiesData.length > 0) {
                activitiesData.forEach(round => {
                    if(round.quiz) {
                        round.quiz.forEach(q => {
                            q.o = q.o.map(opt => opt.replace('tEktUb', 'ØªÙÙƒÙ’ØªÙØ¨Ù')
                                                    .replace('tEkOni', 'ØªÙÙƒÙÙˆÙ†Ù')
                                                    .replace('yEzhEbu', 'ÙŠÙØ°Ù’Ù‡ÙØ¨Ù')
                                                    .replace('tEzhEbAn', 'ØªÙØ°Ù’Ù‡ÙØ¨ÙØ§Ù†')
                                                    .replace('ElmustEÅŸfA', 'Ø§Ù„Ù…ÙØ³Ù’ØªÙØ´Ù’ÙÙÙ‰')
                                                    .replace('mÃ¼derrisan', 'Ù…ÙØ¯ÙØ±Ù‘ÙØ³Ø§Ù†')
                                                    );
                        });
                    }
                });
            }
            prepareRounds();
            loadCurrentRound();
            loadActivity();
        });
    </script>
</body>
</html>